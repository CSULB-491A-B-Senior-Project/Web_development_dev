<body>
    <div class="settings-sidebar">
        <a class="logo" routerLink="/explore"><img src="/assets/crescendo-logo-no-text.png"/></a>
        <h1>Settings</h1>
        <h2 class="active">Edit Profile</h2>
        <h2><a routerLink="/settings-account">Account</a></h2>
        <button class="logout" (click)="onLogout()">Logout</button>

    </div>

    <div class="settings-container">
        <!-- CUSTOMIZE PROFILE PICTURE -->
        <h1>Profile Picture</h1>
        <p>Upload a new photo for your profile.</p>
        <div class="profile-picture-container">
            <img class="profile-picture" [ngSrc]="profilePictureUrl()" width="100" height="100" alt="Current profile picture"/>
            <button type="button" class="action-button" (click)="profilePicInput.click()">
                <span>Change Picture</span>
                <input
                #profilePicInput
                type="file"
                accept=".jpg,.png,.jpeg"
                (change)="onProfilePictureSelected($event)"
                style="display: none;"
                />
            </button>
        </div>

        <!-- CUSTOMIZE BACKGROUND -->
        <h1>Background</h1>
        <p>Upload a new image to personalize your profile background.</p>
        <div class="file-upload-container">
            <button type="button" class="custom-upload-button" (click)="fileInput.click()">
                <span>Upload</span>
                <input
                #fileInput
                type="file"
                accept=".jpg,.png,.jpeg"
                (change)="onFileSelected($event)"
                style="display: none;"
                />
            </button>
            <span class="file-name">{{ selectedFileName() || 'No file selected. Must not exceed 5MB. File types .jpg, .png, .jpeg accepted.' }}</span>
        </div>

        <!-- CUSTOMIZE BIO -->
        <h1>About Me</h1>
        <p>Share a short bio to let others know who you are.</p>
        <form [formGroup]="bioForm" (ngSubmit)="onBioSubmit()" class="bio-form">
            <div class="textarea-wrapper">
                <textarea
                #bioTextarea
                (input)="autoResizeBio()"
                formControlName="bio"
                maxlength="150"
                rows="1"
                class="expanding-textarea"
                ></textarea>
                @if (bioForm.get('bio'); as bio) {
                    <small class="char-count">{{ bio.value?.length || 0 }}/150 characters</small>
                }
            </div>
            <button type="submit" [disabled]="bioForm.invalid">Save Bio</button>
        </form>

        <!-- SELECT MUSIC -->
        <h1>Select music</h1>
        <p>Choose a favorite song to feature on your profile.</p>
        @if (favoriteSong(); as song) {
            <div class="favorite-song-card">
                <img class="item-cover" [ngSrc]="song.albumCover" width="60" height="60" [alt]="song.name" />
                <div class="item-meta">
                    <div class="item-title">{{ song.name }}</div>
                    <div class="item-sub">{{ song.artistName }}</div>
                </div>
                <button type="button" class="clear-btn" (click)="clearFavoriteSong()" title="Clear selection">‚úï</button>
            </div>
        } @else {
            <form [formGroup]="songSearchForm" class="search-container">
                <input
                    class="form-control"
                    type="text"
                    formControlName="query"
                    placeholder="Search for a song..."
                />
                @if (songSearchQuery() && songResults().length > 0) {
                    <ul class="search-results">
                        @for (song of songResults(); track song.id) {
                            <li class="result-item" (click)="selectSong(song)">
                                <img [ngSrc]="song.albumCover" class="item-image" width="50" height="50" [alt]="song.name" />
                                <div class="item-meta">
                                    <span class="item-title">{{ song.name }}</span>
                                    <span class="item-sub">{{ song.artistName }}</span>
                                </div>
                            </li>
                        }
                    </ul>
                }
            </form>
        }
        <button type="button" class="action-button" (click)="saveFavoriteSong()">Save Song</button>

        <div class="favorites-section">
          <h1>Rank top 10 favorite artists</h1>
          <p>Drag to reorder. Changes save automatically.</p>

          <div
            cdkDropList
            (cdkDropListDropped)="dropFavoriteArtist($event)"
            class="artist-rank-list">
            @for (artist of topTenFavoriteArtists(); track artist.id; let i = $index) {
              <div class="artist-rank-item" cdkDrag>
                <span class="rank-number">{{ i + 1 }}</span>
                <img [ngSrc]="artist.artistImage" width="48" height="48" [alt]="artist.artistName" />
                <span class="artist-name">{{ artist.artistName }}</span>
                <span class="drag-handle" cdkDragHandle aria-label="Drag handle">‚ãÆ‚ãÆ</span>
              </div>
            } @empty {
              <p class="empty-list-text">No favorite artists to rank.</p>
            }
          </div>
        </div>

        <!-- CUSTOMIZE FAVORITE ALBUMS-->
        <div class="favorites-section album-favorites">
          <h1>Edit favorite albums</h1>
          <p>Heart albums to add them. Click again to remove.</p>

          <form [formGroup]="albumSearchForm" class="search-container">
            <input
              class="form-control"
              type="text"
              formControlName="query"
              placeholder="Search for albums to add..." />
            @if (albumSearchQuery() && albumResults().length > 0) {
              <ul class="search-results">
                @for (album of albumResults(); track album.id) {
                  <li class="result-item" (click)="addAlbumToFavorites(album)">
                    <img [ngSrc]="album.albumCover" class="item-image" width="50" height="50" [alt]="album.name" />
                    <div class="item-meta">
                      <span class="item-title">{{ album.name }}</span>
                      <span class="item-sub">{{ album.artist.artistName }} ‚Ä¢ {{ album.releaseYear }}</span>
                    </div>
                    <button
                      type="button"
                      class="heart-btn"
                      aria-label="Add {{ album.name }} to favorites">
                      ü§ç
                    </button>
                  </li>
                }
              </ul>
            }
          </form>

          <div class="selection-list album-list">
            @for (album of favoriteAlbums(); track album.id) {
              <div class="selection-item">
                <img [ngSrc]="album.albumCover" class="item-image" width="50" height="50" [alt]="album.name" />
                <div class="item-meta">
                  <span class="item-title">{{ album.name }}</span>
                  <span class="item-sub">{{ album.artist.artistName }} ‚Ä¢ {{ album.releaseYear }}</span>
                </div>
                <button
                  type="button"
                  class="heart-btn hearted"
                  (click)="removeAlbumFromFavorites(album)"
                  aria-label="Remove {{ album.name }} from favorites">
                  ‚ù§Ô∏è
                </button>
              </div>
            } @empty {
              <p class="empty-list-text">No favorite albums yet. Search above to add some.</p>
            }
          </div>
        </div>
    </div>
</body>