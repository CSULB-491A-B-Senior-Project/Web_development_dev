<div class="settings-sidebar">
    <!-- Optional sidebar content -->
</div>

<main class="settings-container album-review-container">
        <section class="album-header">
            <div class="album-artwork" aria-label="Album artwork"></div>
                <div class="album-details">
                    <header>
                        <h1>
                            Album Name
                            <span class="year">Year</span>
                        </h1>
                        <h3 class="artist-names">Artists Names</h3>
                        <div class="star-rating" aria-label="5-star rating">★★★★★</div>
                    </header>
                </div>
        </section>

        <section class="tracklist">
            <h3>Tracklist</h3>
            <ul>
            <li><span class="track-name">Song 1</span><span class="duration">0:00</span></li>
            <li><span class="track-name">Song 2</span><span class="duration">0:00</span></li>
            <li><span class="track-name">Song 3</span><span class="duration">0:00</span></li>
            <li><span class="track-name">Song 4</span><span class="duration">0:00</span></li>
            <li><span class="track-name">Song 5</span><span class="duration">0:00</span></li>
            <li><span class="track-name">Song 6</span><span class="duration">0:00</span></li>
            </ul>
        </section>

        <section class="comment-section">
            <button class="add-comment-button" type="button" (click)="openCommentModal()">Add Comment</button>
 
            <div class="comments">
                <article class="comment" *ngFor="let c of comments()">
                    <p class="username">{{ c.author || 'username' }}</p>
                    <p class="comment-text">{{ c.text }}</p>
                    <div class="comment-meta">
                      {{ c.createdAt | date:'short' }}
                      <button type="button" class="reply-button" (click)="openReply(c.id)" aria-expanded="{{ replyTargetId() === c.id }}">
                        Reply
                      </button>
                    </div>

                    <!-- existing replies -->
                    <div class="replies" *ngIf="c.replies?.length">
                      <article class="reply" *ngFor="let r of c.replies">
                        <p class="username">{{ r.author || 'username' }}</p>
                        <p class="comment-text">{{ r.text }}</p>
                        <div class="comment-meta">{{ r.createdAt | date:'short' }}</div>
                      </article>
                    </div>

                    <!-- reply form shown for this comment -->
                    <div class="reply-form" *ngIf="replyTargetId() === c.id">
                      <form [formGroup]="replyForm" (ngSubmit)="submitReply(c.id)">
                        <label>
                          Reply
                          <textarea formControlName="text" maxlength="500" rows="3" class="expanding-textarea"></textarea>
                        </label>
                        <div class="error" *ngIf="replyForm.controls.text.invalid && replyForm.controls.text.touched">
                          Reply is required (max 500).
                        </div>
                        <div class="modal-actions">
                          <button type="button" class="btn" (click)="closeReply()">Cancel</button>
                          <button type="submit" class="btn primary" [disabled]="replyForm.invalid">Submit</button>
                        </div>
                      </form>
                    </div>
                </article>

                <article class="comment">
                    <p class="username">username</p>
                    <p class="comment-text">comment text</p>
                    <div class="comment-meta">
                        1d • 1<i class="fa-solid fa-thumbs-up"></i> • 1<i class="fa-solid fa-thumbs-down"></i> • Reply
                    </div>
                </article>

                <article class="comment">
                    <p class="username">username</p>
                    <p class="comment-text">comment text</p>
                    <div class="comment-meta">1w • 1<i class="fa-solid fa-thumbs-up"></i> • Reply</div>
                </article>
            </div>
         </section>

        <!-- Comment modal -->
        <div class="modal-backdrop" *ngIf="showCommentModal()" (click)="closeCommentModal()">
          <div class="modal" role="dialog" aria-modal="true" (click)="$event.stopPropagation()" (keydown.escape)="closeCommentModal()" tabindex="0">
            <h3>Add a comment</h3>

            <!-- show posting username (not editable) -->
            <div class="modal-author" aria-hidden="true">
              Posting as <strong>{{ username }}</strong>
            </div>

            <form [formGroup]="commentForm" (ngSubmit)="submitComment()">
              <label>
                Comment
                <textarea
                formControlName="text"
                maxlength="150"
                rows="4"
                class="expanding-textarea"
                (input)="autoResize($event)"
                ></textarea>
              </label>
              <div class="error" *ngIf="commentForm.controls.text.invalid && commentForm.controls.text.touched">
                Comment is required (max 1000).
              </div>

              <div class="modal-actions">
                <button type="button" class="btn" (click)="closeCommentModal()">Cancel</button>
                <button type="submit" class="btn primary" [disabled]="commentForm.invalid">Submit</button>
              </div>
            </form>
          </div>
        </div>
     </main>
