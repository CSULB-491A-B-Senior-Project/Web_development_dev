<div *ngIf="isVisible && (playerState$ | async) as state" 
     class="floating-player" 
     cdkDrag
     cdkDragBoundary=".app-container">
  
  <!-- Drag Handle -->
  <div class="player-header" cdkDragHandle>
    <div class="drag-indicator">
      <span class="drag-icon">â‹®â‹®</span>
    </div>
    <div class="header-controls">
      <button class="minimize-btn" (click)="toggleMinimize()" title="Minimize">
        {{ isMinimized ? 'â–²' : 'â–¼' }}
      </button>
      <button class="close-btn" (click)="close()" title="Close">
        âœ•
      </button>
    </div>
  </div>

  <!-- Player Content -->
  <div class="player-content" [class.minimized]="isMinimized">
    
    <!-- Album Art and Track Info -->
    <div class="track-display">
      <img [src]="state.albumArt" alt="Album Art" class="album-art">
      <div class="track-info">
        <div class="track-name" [title]="state.trackName">{{ state.trackName }}</div>
        <div class="artist-name" [title]="state.artistName">{{ state.artistName }}</div>
      </div>
    </div>

    <!-- Playback Controls -->
    <div class="controls-section">
      <div class="playback-controls">
        <button class="control-btn" (click)="togglePlay()" [title]="state.isPlaying ? 'Pause' : 'Play'">
          {{ state.isPlaying ? 'â¸' : 'â–¶' }}
        </button>
      </div>

      <!-- Progress Bar -->
      <div class="progress-section">
        <span class="time-label">{{ formatTime(state.position) }}</span>
        <input 
          type="range" 
          class="progress-bar" 
          min="0" 
          [max]="state.duration" 
          [value]="state.position" 
          (input)="seek($event)">
        <span class="time-label">{{ formatTime(state.duration) }}</span>
      </div>

      <!-- Volume Control -->
      <div class="volume-section">
        <span class="volume-icon">ğŸ”Š</span>
        <input 
          type="range" 
          class="volume-bar" 
          min="0" 
          max="1" 
          step="0.01" 
          (input)="setVolume($event)">
      </div>
    </div>

  </div>
</div>
